---
sidebar_position: 4
title: 4. ROS2 Avan√ßado
description: Actions, lifecycle, parameters e TF2
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# üöÄ ROS2 Avan√ßado

:::tip Objetivo
Actions, lifecycle nodes, parameters din√¢micos e transforma√ß√µes (TF2).
:::

---

## üé¨ Actions (Tarefas de Longa Dura√ß√£o)

### Diferen√ßa: Topic vs Service vs Action

| Tipo | Dura√ß√£o | Feedback | Cancel√°vel |
|------|---------|----------|------------|
| **Topic** | Cont√≠nuo | N√£o | N√£o |
| **Service** | Curto (&lt;1s) | N√£o | N√£o |
| **Action** | Longo (1s-‚àû) | ‚úÖ Sim | ‚úÖ Sim |

### Action Server

```python
from action_tutorials_interfaces.action import Fibonacci
from rclpy.action import ActionServer

class FibonacciServer(Node):
    def __init__(self):
        super().__init__('fibonacci_server')
        self._action_server = ActionServer(
            self, Fibonacci, 'fibonacci',
            self.execute_callback
        )
    
    async def execute_callback(self, goal_handle):
        feedback = Fibonacci.Feedback()
        feedback.sequence = [0, 1]
        
        for i in range(1, goal_handle.request.order):
            feedback.sequence.append(
                feedback.sequence[i] + feedback.sequence[i-1]
            )
            goal_handle.publish_feedback(feedback)
            await asyncio.sleep(0.5)  # Simula processamento
        
        goal_handle.succeed()
        result = Fibonacci.Result()
        result.sequence = feedback.sequence
        return result
```

---

## ‚öôÔ∏è Parameters (Configura√ß√£o Din√¢mica)

```python
class ConfigurableNode(Node):
    def __init__(self):
        super().__init__('configurable_node')
        
        # Declarar par√¢metros
        self.declare_parameter('max_speed', 1.0)
        self.declare_parameter('robot_name', 'Atlas')
        
        # Ler valores
        self.max_speed = self.get_parameter('max_speed').value
        self.robot_name = self.get_parameter('robot_name').value
        
        # Callback quando par√¢metro mudar
        self.add_on_set_parameters_callback(self.parameter_callback)
    
    def parameter_callback(self, params):
        for param in params:
            if param.name == 'max_speed':
                self.max_speed = param.value
                self.get_logger().info(f'Speed updated to {self.max_speed}')
        return SetParametersResult(successful=True)
```

**Mudar em runtime:**

```bash
ros2 param set /configurable_node max_speed 2.0
```

---

## üó∫Ô∏è TF2 (Transforma√ß√µes)

### Broadcast Transform

```python
from tf2_ros import TransformBroadcaster
from geometry_msgs.msg import TransformStamped

class FramePublisher(Node):
    def __init__(self):
        super().__init__('frame_publisher')
        self.br = TransformBroadcaster(self)
        self.timer = self.create_timer(0.1, self.broadcast_timer_callback)
    
    def broadcast_timer_callback(self):
        t = TransformStamped()
        t.header.stamp = self.get_clock().now().to_msg()
        t.header.frame_id = 'world'
        t.child_frame_id = 'robot_base'
        
        t.transform.translation.x = 1.0
        t.transform.translation.y = 0.5
        t.transform.translation.z = 0.0
        
        self.br.sendTransform(t)
```

---

## üîó Pr√≥ximos Passos

:::tip Pr√≥ximo M√≥dulo
**[üëÅÔ∏è Vis√£o Computacional ‚Üí](./visao-computacional)**

OpenCV, detec√ß√£o de objetos e tracking.
:::
